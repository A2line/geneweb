<!DOCTYPE html>
<html lang="%lang;">
<head>
  <!-- $Id: images.txt, v7.00-exp 16/11/2018 05:35:27 hg a2 $ -->
  <!-- Copyright (c) 1998-2018 INRIA -->
  <title>[*add]/[delete::image/images]0 #%index;</title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="%image_prefix;/favicon_gwd.png">
  %include.css;
  %base_header;
</head>
<body%body_prop; id="person">
<div class="container">
%message_to_wizard;
%include_perso_header;

%if;(evar.m="SND_IMAGE")
  <div class="row">
    <div class="col-6 border border-bottom-0 border-top-0 border-left-0">
      <h1><i class="fas fa-portrait fa-fw text-primary mr-1"></i>[*add picture]0</h1>
      <form class="form-row" method="post" action="%action;" enctype="multipart/form-data">
        <input type="hidden" name="m" value="SND_IMAGE_OK">
        <input type="hidden" name="digest" value="%digest;">
        <input type="hidden" name="i" value="%index;">
        <div class="custom-file col">
          <input type="file" name="file" class="custom-file-input" id="portrait_file" accept="image/*" lang="%lang;">
          <label class="custom-file-label text-truncate" for="portrait_file">[*select] [image/images]0</label>
        </div>
        <button class="btn btn-primary ml-1 col-2" type="submit" %if;(evar.m!="SND_IMAGE")disabled%end;
          class="btn mt-2 text-capitalize">[*send]</button>
      </form>
      <span>[*previous portrait]</span><br>
      <span>[*if previous portrait exists]<span>
       %(TODO: print only if old img already exists%)
    </div>
    <div class="col-6">
      %if;(has_image)
        <h1><i class="fas fa-portrait fa-fw text-danger mr-1"></i>[*add picture]1</h1>
        <a role="button" href="%prefix;m=DEL_IMAGE&i=%index;" class="btn btn-danger">[*add picture]1</a>
      %end;
    </div>
  </div>
  <hr>
  <div class="row mt-3">
    <div class="col-6 border border-bottom-0 border-top-0 border-left-0">
      <h1><i class="fas fa-image fa-fw text-primary mr-1"></i>[*add] [image/images]0</h1>
      <form class="form-row" method="post" action="%action;" enctype="multipart/form-data">
        <input type="hidden" name="m" value="SND_IMAGE_OK">
        <input type="hidden" name="digest" value="%digest;">
        <input type="hidden" name="i" value="%index;">
        <input type="hidden" name="keydir" id="keydir" value="on">
        <div class="custom-file col">
          %( ce champ file (XX) doit êrte rempli automatiquement si on sélectionne une image %)
          <input type="file" name="file" class="custom-file-input" id="others_file" accept="image/*"%( multiple%) lang="%lang;">
          <label class="custom-file-label text-truncate" for="others_file"><span>[*select] [image/images]0</span></label>
        </div>
        <button class="btn btn-primary ml-1 col-2" type="submit" %if;(evar.m!="SND_IMAGE")disabled%end;
          class="btn mt-2">[*send]</button>
        <div class="row ml-2">
          <div class="d-inline col-9 py-1">%include.toolbar;</div>
          <textarea class="col-11 form-control" id="notes_edit" name="notes" rows="5">
          </textarea>%sq;
          [*image comment]
        </div>
      </form>
    </div>
    <div class="col-6">
      %if;(has_keydir and nb_keydir_img>0)
    <h1><i class="fas fa-image fa-fw text-primary mr-1"></i>[*available images]</h1>
      <form class="form" method="post" action="%action;" enctype="multipart/form-data">
        <input type="hidden" name="m" value="DEL_IMAGE_OK">
        <input type="hidden" name="digest" value="%digest;">
        <input type="hidden" name="i" value="%index;">
        <input type="hidden" name="keydir" id="keydir" value="on">
        %foreach;img_in_keydir;
            %( remplir le champ file de l'autre form (XX) quand on clique sur le radio bouton %)
            <input type="radio" name="file_name" value="%keydir_img;" %nn;
              %if;(evar.get_notes="on" and keydir_img=evar.notes_name)
                checked%nn;
              %end;
            >&nbsp;%keydir_img;%sp;
            ( <a href="%prefix;m=SND_IMAGE&get_notes=on&i=%index;&notes_name=%keydir_img;"
                  title="[*image comment]" %nn;
                  %if;(evar.get_notes="on" and keydir_img=evar.notes_name)
                    id="get_notes" %nn;
                  %end; onclick="get_notes(%cnt;); return false;" %nn;
                  %if;(keydir_img_notes!="")
                    tabindex="0" data-trigger="focus" data-toggle="popover"
                    data-placement="bottom" data-html="true" %nn;
                    data-content="%keydir_img_notes;"%nn;
                  %end;
              >%nn;
                 <i class="fas fa-image fa-fw text-primary mr-1"></i>%nn;
              </a>)<br>
            <input type="hidden" name="file" value="%keydir_img;">
            %( on a déjà el contenu de %keydir_img_notes;!! Comment le partager avec le popover? %)
            <input type="hidden" id="notes_content_%cnt;" value="%keydir_img_notes;">
        %end;
        <br>
        <button type="submit" class="btn btn-danger ml-1 col-4">[*delete] [image/images]0</button>
      </form>
      <span>[*previous image %s:::/keydir] (keydir=%keydir;)</span><br>
      <span>[*if previous image exists %s:::/keydir]<span>
      %(TODO: print only if old img already exists%)
      %end;
    </div>
  </div>
    <p>
%elseif;(evar.m="DEL_IMAGE")
  <div class="col-6">
    <h1><i class="fas fa-portrait fa-fw text-danger mr-1"></i>[*add picture]1</h1>
    <a role="button" href="%prefix;m=DEL_IMAGE_OK&i=%index;" class="btn btn-danger ml-5 col-6">[*validate/delete]0%( [add picture]1%)</a>
  </div>
%end;
%base_trailer;
%include.copyr;
</div>
%include.js;
<script>
$('.custom-file-input').on('change', function() {
   let fileName = $(this).val().split('\\').pop();
   $(this).next('.custom-file-label').addClass("selected").html(fileName);
});
// Initialize Bootstrap tooltip and popover component, dismiss on next click function
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
$(function () {
  $('[data-toggle="popover"]').popover()
})
$('.popover-dismiss').popover({
  trigger: 'focus'
})
</script>

<script>
%( On doit pouvoir faie mieux et éviter l'appel au serveur à al façon popover %)
function get_notes (cnt) {
var notes = "notes_content_"+cnt;
var item = document.getElementById(notes).value;
document.getElementById("notes_edit").value=item;
}
</script>
%( Possible heavier futur script to manage multiple files inputs
   https://github.com/Johann-S/bs-custom-file-input/blob/master/dist/bs-custom-file-input.min.js
<script src=%if;(cgi)%bvar.static_path;%end;js/bs-custom-file-input.min.js></script>
<script>$(document).ready(function(){bsCustomFileInput.init()})</script> %)
</body>
</html>
