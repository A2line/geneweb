%( perso.txt file producing algolia indexing record %)
%(
This template creates a record for one individual.
The attributes are :
  objectId: unique id
  url: url to the individual in the base
  image: url to the individual's image
  names; name and surname_aliases
  firstnames: first_name, first_name aliases, aliases  and qualifiers
  dates: year of several events (birth, death, marriage)
  locations: location associated with birth, death and marraiges
  notes: the note
  dummy: to close the record

The program Make-algolia.py will process the returned data to correct several 
imperfections (extra \n, spaces, , ...) escapes the " found in notes and removes 
unwanted html tags.

A future version will produce a clean final file.
%)

%if;(first_name_key!="" and surname_key!="")
{<br>%nn;
/separator/objectID/separator/: /separator/%first_name_key;.%occ;.%surname_key;/separator/,<br>%nn;
/separator/url/separator/: /separator/http://localweb.fr:2317/%base.name;?w=xy:zz;%access;/separator/,<br>%nn;
%if;has_image;
/separator/image/separator/: /separator/http://localweb.fr:2317/%base.name?w=xy:zz;%image_url;/separator/,<br>%nn;
%end;
/separator/names/separator/:  /separator/%nn;
%surname;%sp;
%if;has_surnames_aliases;(
  %foreach;surname_alias;
    %surname_alias;%sp;
  %end;)
%end;
/separator/,<br>%nn;

/separator/firstnames/separator/:  /separator/%nn;
%first_name;%sp;
%if;has_first_names_aliases;
  %foreach;first_name_alias;
    , %first_name_alias;%sp;
  %end
%end;
%if;has_qualifiers;
  %foreach;qualifier;
    , %qualifier;%sp;
  %end
%end;
%if;has_aliases;
  %foreach;alias;
    , %alias;%sp;
  %end;
%end;
/separator/,<br>%nn;
  
/separator/dates/separator/: /separator/%nn;
  %if;has_birth_date;, %birth_date.year;%sp;%end;
  %if;has_death_date;, %death_date.year;%sp;%end;
  %if;has_families;
    %foreach;family;
      %if;(marriage_date!="")
        , %marriage_date.year;%sp;
      %end;
    %end;
  %end;
/separator/,<br>%nn;

/separator/locations/separator/: /separator/%nn;
  %if;has_birth_place;, %birth_place;%sp;%end;
  %if;has_death_place;, %death_place;%sp;%end;
  %if;has_families;
    %foreach;family;
      %if;(marriage_place!="")
        , %marriage_place;%sp;
      %end;
    %end;
  %end;
/separator/,<br>%nn;

%if;has_notes;
/separator/notes/separator/: /separator/%notes;/separator/,<br>%nn;
%end;

%if;has_sources;
/separator/sources/separator/: /separator/%nn;
  %foreach;source;
    , %source;%sp;
  %end;
/separator/,<br>%nn;
%end;


/separator/dummy/separator/: /separator//separator/<br>%nn;
},
%end;